<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <link rel="dns-prefetch" href="http://yoursite.com">
  <title>PHP自定义函数 | Vhen</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="1、判断用户输入是否存在敏感词1234567891011function sensitive($content)&amp;#123;    //$arr=C(&apos;SENSITIVE&apos;);    import(&quot;ORG.SensitiveFilter&quot;);//添加敏感词类文件SensitiveFilter.php    $arr=SensitiveFilter::getWord();    foreach (">
<meta property="og:type" content="article">
<meta property="og:title" content="PHP自定义函数">
<meta property="og:url" content="http://yoursite.com/2016/11/20/PHP自定义函数/index.html">
<meta property="og:site_name" content="Vhen">
<meta property="og:description" content="1、判断用户输入是否存在敏感词1234567891011function sensitive($content)&amp;#123;    //$arr=C(&apos;SENSITIVE&apos;);    import(&quot;ORG.SensitiveFilter&quot;);//添加敏感词类文件SensitiveFilter.php    $arr=SensitiveFilter::getWord();    foreach (">
<meta property="og:updated_time" content="2016-11-19T18:48:37.794Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PHP自定义函数">
<meta name="twitter:description" content="1、判断用户输入是否存在敏感词1234567891011function sensitive($content)&amp;#123;    //$arr=C(&apos;SENSITIVE&apos;);    import(&quot;ORG.SensitiveFilter&quot;);//添加敏感词类文件SensitiveFilter.php    $arr=SensitiveFilter::getWord();    foreach (">
  
    <link rel="alternative" href="/atom.xml" title="Vhen" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/main.css">
  

</head>

<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="http://www.qq1234.org/uploads/allimg/150506/0T55S025-3.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Vhen</a></h1>
		</hgroup>

		
		<p class="header-subtitle">一个人的坚强不是看他外壳有多硬，而是看他的疤痕有多深</p>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="/photo">相册</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
    			
    			<a class="js-smart-menu" data-idx="0" href="javascript:void(0)">所有文章</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="1" href="javascript:void(0)">标签</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="2" href="javascript:void(0)">友链</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="3" href="javascript:void(0)">关于我</a>
    			
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/Vhens" title="github">github</a>
		        
					<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
		        
					<a class="rss" target="_blank" href="#" title="rss">rss</a>
		        
					<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
		        
			</div>
		</nav>
	</header>
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-list"></i></div>
  		<h1 class="header-author js-mobile-header hide">Vhen</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="http://www.qq1234.org/uploads/allimg/150506/0T55S025-3.jpg" class="js-avatar">
				
			</div>
			<hgroup>
			  <h1 class="header-author">Vhen</h1>
			</hgroup>
			
			<p class="header-subtitle">一个人的坚强不是看他外壳有多硬，而是看他的疤痕有多深</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/photo">相册</a></li>
		        
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/Vhens" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="#" title="rss">rss</a>
			        
						<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
        <article id="post-PHP自定义函数" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      PHP自定义函数
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>1、判断用户输入是否存在敏感词<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span> sensitive(<span class="variable">$content</span>)&#123;</div><div class="line">    //<span class="variable">$arr</span>=C(<span class="string">'SENSITIVE'</span>);</div><div class="line">    import(<span class="string">"ORG.SensitiveFilter"</span>);//添加敏感词类文件SensitiveFilter.php</div><div class="line">    <span class="variable">$arr</span>=SensitiveFilter::getWord();</div><div class="line">    foreach (<span class="variable">$arr</span> as <span class="variable">$v</span>) &#123;</div><div class="line">        <span class="keyword">if</span> (<span class="literal">false</span> !== strstr(<span class="variable">$content</span>, <span class="variable">$v</span>))&#123;</div><div class="line">            <span class="variable">$content</span>=str_replace(<span class="variable">$v</span>,<span class="string">'***'</span>,<span class="variable">$content</span>);//内容中存在敏感词库中的敏感词，则将敏感词用*替换</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">return</span> <span class="variable">$content</span>;</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>2、检测是否登录<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span> <span class="function"><span class="title">check_login</span></span>()&#123;</div><div class="line">    <span class="keyword">if</span> (!empty(<span class="variable">$_SESSION</span>[<span class="string">'user'</span>][<span class="string">'id'</span>]))&#123;</div><div class="line">        <span class="built_in">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="built_in">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>3、删除指定的标签和内容<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 删除指定的标签和内容</div><div class="line"> * @param array <span class="variable">$tags</span> 需要删除的标签数组</div><div class="line"> * @param string <span class="variable">$str</span> 数据源</div><div class="line"> * @param string <span class="variable">$content</span> 是否删除标签内的内容 0保留内容 1不保留内容</div><div class="line"> * @<span class="built_in">return</span> string</div><div class="line"> */</div><div class="line"><span class="keyword">function</span> strip_html_tags(<span class="variable">$tags</span>,<span class="variable">$str</span>,<span class="variable">$content</span>=0)&#123;</div><div class="line">    <span class="keyword">if</span>(<span class="variable">$content</span>)&#123;</div><div class="line">        <span class="variable">$html</span>=array();</div><div class="line">        foreach (<span class="variable">$tags</span> as <span class="variable">$tag</span>) &#123;</div><div class="line">            <span class="variable">$html</span>[]=<span class="string">'/([\s|\S]*?)/'</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="variable">$data</span>=preg_replace(<span class="variable">$html</span>,<span class="string">''</span>,<span class="variable">$str</span>);</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="variable">$html</span>=array();</div><div class="line">        foreach (<span class="variable">$tags</span> as <span class="variable">$tag</span>) &#123;</div><div class="line">            <span class="variable">$html</span>[]=<span class="string">"/(]*&gt;)/i"</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="variable">$data</span>=preg_replace(<span class="variable">$html</span>, <span class="string">''</span>, <span class="variable">$str</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">return</span> <span class="variable">$data</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>4、传递数据以易于阅读的样式格式化后输出<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span> p(<span class="variable">$data</span>)&#123;</div><div class="line">    // 定义样式</div><div class="line">    <span class="variable">$str</span>=<span class="string">'&lt;pre style="display: block;padding: 9.5px;margin: 44px 0 0 0;font-size: 13px;line-height: 1.42857;color: #333;word-break: break-all;word-wrap: break-word;background-color: #F5F5F5;border: 1px solid #CCC;border-radius: 4px;"&gt;'</span>;</div><div class="line">    // 如果是boolean或者null直接显示文字；否则<span class="built_in">print</span></div><div class="line">    <span class="keyword">if</span> (is_bool(<span class="variable">$data</span>)) &#123;</div><div class="line">        <span class="variable">$show_data</span>=<span class="variable">$data</span> ? <span class="string">'true'</span> : <span class="string">'false'</span>;</div><div class="line">    &#125;elseif (is_null(<span class="variable">$data</span>)) &#123;</div><div class="line">        <span class="variable">$show_data</span>=<span class="string">'null'</span>;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="variable">$show_data</span>=print_r(<span class="variable">$data</span>,<span class="literal">true</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="variable">$str</span>.=<span class="variable">$show_data</span>;</div><div class="line">    <span class="variable">$str</span>.=<span class="string">'&lt;/pre&gt;'</span>;</div><div class="line">    <span class="built_in">echo</span> <span class="variable">$str</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>5、app 图片上传<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span> app_upload_image(<span class="variable">$path</span>,<span class="variable">$maxSize</span>=52428800)&#123;</div><div class="line">    ini_set(<span class="string">'max_execution_time'</span>, <span class="string">'0'</span>);</div><div class="line">    // 去除两边的/</div><div class="line">    <span class="variable">$path</span>=trim(<span class="variable">$path</span>,<span class="string">'.'</span>);</div><div class="line">    <span class="variable">$path</span>=trim(<span class="variable">$path</span>,<span class="string">'/'</span>);</div><div class="line">    <span class="variable">$config</span>=array(</div><div class="line">        <span class="string">'rootPath'</span>  =&gt;<span class="string">'./'</span>,         //文件上传保存的根路径</div><div class="line">        <span class="string">'savePath'</span>  =&gt;<span class="string">'./'</span>.<span class="variable">$path</span>.<span class="string">'/'</span>,</div><div class="line">        <span class="string">'exts'</span>      =&gt; array(<span class="string">'jpg'</span>, <span class="string">'gif'</span>, <span class="string">'png'</span>, <span class="string">'jpeg'</span>,<span class="string">'bmp'</span>),</div><div class="line">        <span class="string">'maxSize'</span>   =&gt; <span class="variable">$maxSize</span>,</div><div class="line">        <span class="string">'autoSub'</span>   =&gt; <span class="literal">true</span>,</div><div class="line">        );</div><div class="line">    <span class="variable">$upload</span> = new \Think\Upload(<span class="variable">$config</span>);// 实例化上传类</div><div class="line">    <span class="variable">$info</span> = <span class="variable">$upload</span>-&gt;upload();</div><div class="line">    <span class="keyword">if</span>(<span class="variable">$info</span>) &#123;</div><div class="line">        foreach (<span class="variable">$info</span> as <span class="variable">$k</span> =&gt; <span class="variable">$v</span>) &#123;</div><div class="line">            <span class="variable">$data</span>[]=trim(<span class="variable">$v</span>[<span class="string">'savepath'</span>],<span class="string">'.'</span>).<span class="variable">$v</span>[<span class="string">'savename'</span>];</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">return</span> <span class="variable">$data</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>6、app 视频上传<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span> app_upload_video(<span class="variable">$path</span>,<span class="variable">$maxSize</span>=52428800)&#123;</div><div class="line">    ini_set(<span class="string">'max_execution_time'</span>, <span class="string">'0'</span>);</div><div class="line">    // 去除两边的/</div><div class="line">    <span class="variable">$path</span>=trim(<span class="variable">$path</span>,<span class="string">'.'</span>);</div><div class="line">    <span class="variable">$path</span>=trim(<span class="variable">$path</span>,<span class="string">'/'</span>);</div><div class="line">    <span class="variable">$config</span>=array(</div><div class="line">        <span class="string">'rootPath'</span>  =&gt;<span class="string">'./'</span>,         //文件上传保存的根路径</div><div class="line">        <span class="string">'savePath'</span>  =&gt;<span class="string">'./'</span>.<span class="variable">$path</span>.<span class="string">'/'</span>,</div><div class="line">        <span class="string">'exts'</span>      =&gt; array(<span class="string">'mp4'</span>,<span class="string">'avi'</span>,<span class="string">'3gp'</span>,<span class="string">'rmvb'</span>,<span class="string">'gif'</span>,<span class="string">'wmv'</span>,<span class="string">'mkv'</span>,<span class="string">'mpg'</span>,<span class="string">'vob'</span>,<span class="string">'mov'</span>,<span class="string">'flv'</span>,<span class="string">'swf'</span>,<span class="string">'mp3'</span>,<span class="string">'ape'</span>,<span class="string">'wma'</span>,<span class="string">'aac'</span>,<span class="string">'mmf'</span>,<span class="string">'amr'</span>,<span class="string">'m4a'</span>,<span class="string">'m4r'</span>,<span class="string">'ogg'</span>,<span class="string">'wav'</span>,<span class="string">'wavpack'</span>),</div><div class="line">        <span class="string">'maxSize'</span>   =&gt; <span class="variable">$maxSize</span>,</div><div class="line">        <span class="string">'autoSub'</span>   =&gt; <span class="literal">true</span>,</div><div class="line">        );</div><div class="line">    <span class="variable">$upload</span> = new \Think\Upload(<span class="variable">$config</span>);// 实例化上传类</div><div class="line">    <span class="variable">$info</span> = <span class="variable">$upload</span>-&gt;upload();</div><div class="line">    <span class="keyword">if</span>(<span class="variable">$info</span>) &#123;</div><div class="line">        foreach (<span class="variable">$info</span> as <span class="variable">$k</span> =&gt; <span class="variable">$v</span>) &#123;</div><div class="line">            <span class="variable">$data</span>[]=trim(<span class="variable">$v</span>[<span class="string">'savepath'</span>],<span class="string">'.'</span>).<span class="variable">$v</span>[<span class="string">'savename'</span>];</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">return</span> <span class="variable">$data</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>7、返回文件格式<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span> file_format(<span class="variable">$str</span>)&#123;</div><div class="line">    // 取文件后缀名</div><div class="line">    <span class="variable">$str</span>=strtolower(pathinfo(<span class="variable">$str</span>, PATHINFO_EXTENSION));</div><div class="line">    // 图片格式</div><div class="line">    <span class="variable">$image</span>=array(<span class="string">'webp'</span>,<span class="string">'jpg'</span>,<span class="string">'png'</span>,<span class="string">'ico'</span>,<span class="string">'bmp'</span>,<span class="string">'gif'</span>,<span class="string">'tif'</span>,<span class="string">'pcx'</span>,<span class="string">'tga'</span>,<span class="string">'bmp'</span>,<span class="string">'pxc'</span>,<span class="string">'tiff'</span>,<span class="string">'jpeg'</span>,<span class="string">'exif'</span>,<span class="string">'fpx'</span>,<span class="string">'svg'</span>,<span class="string">'psd'</span>,<span class="string">'cdr'</span>,<span class="string">'pcd'</span>,<span class="string">'dxf'</span>,<span class="string">'ufo'</span>,<span class="string">'eps'</span>,<span class="string">'ai'</span>,<span class="string">'hdri'</span>);</div><div class="line">    // 视频格式</div><div class="line">    <span class="variable">$video</span>=array(<span class="string">'mp4'</span>,<span class="string">'avi'</span>,<span class="string">'3gp'</span>,<span class="string">'rmvb'</span>,<span class="string">'gif'</span>,<span class="string">'wmv'</span>,<span class="string">'mkv'</span>,<span class="string">'mpg'</span>,<span class="string">'vob'</span>,<span class="string">'mov'</span>,<span class="string">'flv'</span>,<span class="string">'swf'</span>,<span class="string">'mp3'</span>,<span class="string">'ape'</span>,<span class="string">'wma'</span>,<span class="string">'aac'</span>,<span class="string">'mmf'</span>,<span class="string">'amr'</span>,<span class="string">'m4a'</span>,<span class="string">'m4r'</span>,<span class="string">'ogg'</span>,<span class="string">'wav'</span>,<span class="string">'wavpack'</span>);</div><div class="line">    // 压缩格式</div><div class="line">    <span class="variable">$zip</span>=array(<span class="string">'rar'</span>,<span class="string">'zip'</span>,<span class="string">'tar'</span>,<span class="string">'cab'</span>,<span class="string">'uue'</span>,<span class="string">'jar'</span>,<span class="string">'iso'</span>,<span class="string">'z'</span>,<span class="string">'7-zip'</span>,<span class="string">'ace'</span>,<span class="string">'lzh'</span>,<span class="string">'arj'</span>,<span class="string">'gzip'</span>,<span class="string">'bz2'</span>,<span class="string">'tz'</span>);</div><div class="line">    // 文档格式</div><div class="line">    <span class="variable">$text</span>=array(<span class="string">'exe'</span>,<span class="string">'doc'</span>,<span class="string">'ppt'</span>,<span class="string">'xls'</span>,<span class="string">'wps'</span>,<span class="string">'txt'</span>,<span class="string">'lrc'</span>,<span class="string">'wfs'</span>,<span class="string">'torrent'</span>,<span class="string">'html'</span>,<span class="string">'htm'</span>,<span class="string">'java'</span>,<span class="string">'js'</span>,<span class="string">'css'</span>,<span class="string">'less'</span>,<span class="string">'php'</span>,<span class="string">'pdf'</span>,<span class="string">'pps'</span>,<span class="string">'host'</span>,<span class="string">'box'</span>,<span class="string">'docx'</span>,<span class="string">'word'</span>,<span class="string">'perfect'</span>,<span class="string">'dot'</span>,<span class="string">'dsf'</span>,<span class="string">'efe'</span>,<span class="string">'ini'</span>,<span class="string">'json'</span>,<span class="string">'lnk'</span>,<span class="string">'log'</span>,<span class="string">'msi'</span>,<span class="string">'ost'</span>,<span class="string">'pcs'</span>,<span class="string">'tmp'</span>,<span class="string">'xlsb'</span>);</div><div class="line">    // 匹配不同的结果</div><div class="line">    switch (<span class="variable">$str</span>) &#123;</div><div class="line">        <span class="keyword">case</span> in_array(<span class="variable">$str</span>, <span class="variable">$image</span>):</div><div class="line">            <span class="built_in">return</span> <span class="string">'image'</span>;</div><div class="line">            <span class="built_in">break</span>;</div><div class="line">        <span class="keyword">case</span> in_array(<span class="variable">$str</span>, <span class="variable">$video</span>):</div><div class="line">            <span class="built_in">return</span> <span class="string">'video'</span>;</div><div class="line">            <span class="built_in">break</span>;</div><div class="line">        <span class="keyword">case</span> in_array(<span class="variable">$str</span>, <span class="variable">$zip</span>):</div><div class="line">            <span class="built_in">return</span> <span class="string">'zip'</span>;</div><div class="line">            <span class="built_in">break</span>;</div><div class="line">        <span class="keyword">case</span> in_array(<span class="variable">$str</span>, <span class="variable">$text</span>):</div><div class="line">            <span class="built_in">return</span> <span class="string">'text'</span>;</div><div class="line">            <span class="built_in">break</span>;</div><div class="line">        default:</div><div class="line">            <span class="built_in">return</span> <span class="string">'image'</span>;</div><div class="line">            <span class="built_in">break</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>8、返回iso、Android、ajax的json格式数据<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span> ajax_return(<span class="variable">$data</span>=<span class="string">''</span>,<span class="variable">$error_message</span>=<span class="string">'成功'</span>,<span class="variable">$error_code</span>=1)&#123;</div><div class="line">    <span class="variable">$all_data</span>=array(</div><div class="line">        <span class="string">'error_code'</span>=&gt;<span class="variable">$error_code</span>,</div><div class="line">        <span class="string">'error_message'</span>=&gt;<span class="variable">$error_message</span>,</div><div class="line">        );</div><div class="line">    <span class="keyword">if</span> (<span class="variable">$data</span>!==<span class="string">''</span>) &#123;</div><div class="line">        <span class="variable">$all_data</span>[<span class="string">'data'</span>]=<span class="variable">$data</span>;</div><div class="line">        // app 禁止使用和为了统一字段做的判断</div><div class="line">        <span class="variable">$reserved_words</span>=array(<span class="string">'id'</span>,<span class="string">'title'</span>,<span class="string">'price'</span>,<span class="string">'product_title'</span>,<span class="string">'product_id'</span>,<span class="string">'product_category'</span>,<span class="string">'product_number'</span>);</div><div class="line">        foreach (<span class="variable">$reserved_words</span> as <span class="variable">$k</span> =&gt; <span class="variable">$v</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (array_key_exists(<span class="variable">$v</span>, <span class="variable">$data</span>)) &#123;</div><div class="line">                <span class="built_in">echo</span> <span class="string">'app不允许使用【'</span>.<span class="variable">$v</span>.<span class="string">'】这个键名 —— 此提示是function.php 中的ajax_return函数返回的'</span>;</div><div class="line">                die;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    // 如果是ajax或者app访问；则返回json数据 pc访问直接p出来</div><div class="line">    <span class="built_in">echo</span> json_encode(<span class="variable">$all_data</span>);</div><div class="line">    <span class="built_in">exit</span>(0);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>9、字符串截取，支持中文和其他编码<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 字符串截取，支持中文和其他编码</div><div class="line"> * @param string <span class="variable">$str</span> 需要转换的字符串</div><div class="line"> * @param string <span class="variable">$start</span> 开始位置</div><div class="line"> * @param string <span class="variable">$length</span> 截取长度</div><div class="line"> * @param string <span class="variable">$suffix</span> 截断显示字符</div><div class="line"> * @param string <span class="variable">$charset</span> 编码格式</div><div class="line"> * @<span class="built_in">return</span> string</div><div class="line"> */</div><div class="line"><span class="keyword">function</span> re_substr(<span class="variable">$str</span>, <span class="variable">$start</span>=0, <span class="variable">$length</span>, <span class="variable">$suffix</span>=<span class="literal">true</span>, <span class="variable">$charset</span>=<span class="string">"utf-8"</span>) &#123;</div><div class="line">    <span class="keyword">if</span>(function_exists(<span class="string">"mb_substr"</span>))</div><div class="line">        <span class="variable">$slice</span> = mb_substr(<span class="variable">$str</span>, <span class="variable">$start</span>, <span class="variable">$length</span>, <span class="variable">$charset</span>);</div><div class="line">    elseif(function_exists(<span class="string">'iconv_substr'</span>)) &#123;</div><div class="line">        <span class="variable">$slice</span> = iconv_substr(<span class="variable">$str</span>,<span class="variable">$start</span>,<span class="variable">$length</span>,<span class="variable">$charset</span>);</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="variable">$re</span>[<span class="string">'utf-8'</span>]   = <span class="string">"/[\x01-\x7f]|[\xc2-\xdf][\x80-\xbf]|[\xe0-\xef][\x80-\xbf]&#123;2&#125;|[\xf0-\xff][\x80-\xbf]&#123;3&#125;/"</span>;</div><div class="line">        <span class="variable">$re</span>[<span class="string">'gb2312'</span>] = <span class="string">"/[\x01-\x7f]|[\xb0-\xf7][\xa0-\xfe]/"</span>;</div><div class="line">        <span class="variable">$re</span>[<span class="string">'gbk'</span>]  = <span class="string">"/[\x01-\x7f]|[\x81-\xfe][\x40-\xfe]/"</span>;</div><div class="line">        <span class="variable">$re</span>[<span class="string">'big5'</span>]   = <span class="string">"/[\x01-\x7f]|[\x81-\xfe]([\x40-\x7e]|\xa1-\xfe])/"</span>;</div><div class="line">        preg_match_all(<span class="variable">$re</span>[<span class="variable">$charset</span>], <span class="variable">$str</span>, <span class="variable">$match</span>);</div><div class="line">        <span class="variable">$slice</span> = join(<span class="string">""</span>,array_slice(<span class="variable">$match</span>[0], <span class="variable">$start</span>, <span class="variable">$length</span>));</div><div class="line">    &#125;</div><div class="line">    <span class="variable">$omit</span>=mb_strlen(<span class="variable">$str</span>) &gt;=<span class="variable">$length</span> ? <span class="string">'...'</span> : <span class="string">''</span>;</div><div class="line">    <span class="built_in">return</span> <span class="variable">$suffix</span> ? <span class="variable">$slice</span>.<span class="variable">$omit</span> : <span class="variable">$slice</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>10、按符号截取字符串的指定部分<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 按符号截取字符串的指定部分</div><div class="line"> * @param string <span class="variable">$str</span> 需要截取的字符串</div><div class="line"> * @param string <span class="variable">$sign</span> 需要截取的符号</div><div class="line"> * @param int <span class="variable">$number</span> 如是正数以0为起点从左向右截  负数则从右向左截</div><div class="line"> * @<span class="built_in">return</span> string 返回截取的内容</div><div class="line"> */</div><div class="line">/*  示例</div><div class="line">    <span class="variable">$str</span>=<span class="string">'123/456/789'</span>;</div><div class="line">    cut_str(<span class="variable">$str</span>,<span class="string">'/'</span>,0);  返回 123</div><div class="line">    cut_str(<span class="variable">$str</span>,<span class="string">'/'</span>,-1);  返回 789</div><div class="line">    cut_str(<span class="variable">$str</span>,<span class="string">'/'</span>,-2);  返回 456</div><div class="line">    具体参考 http://www.baijunyao.com/index.php/Home/Index/article/aid/18</div><div class="line">*/</div><div class="line"><span class="keyword">function</span> cut_str(<span class="variable">$str</span>,<span class="variable">$sign</span>,<span class="variable">$number</span>)&#123;</div><div class="line">    <span class="variable">$array</span>=explode(<span class="variable">$sign</span>, <span class="variable">$str</span>);</div><div class="line">    <span class="variable">$length</span>=count(<span class="variable">$array</span>);</div><div class="line">    <span class="keyword">if</span>(<span class="variable">$number</span>&lt;0)&#123;</div><div class="line">        <span class="variable">$new_array</span>=array_reverse(<span class="variable">$array</span>);</div><div class="line">        <span class="variable">$abs_number</span>=abs(<span class="variable">$number</span>);</div><div class="line">        <span class="keyword">if</span>(<span class="variable">$abs_number</span>&gt;<span class="variable">$length</span>)&#123;</div><div class="line">            <span class="built_in">return</span> <span class="string">'error'</span>;</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            <span class="built_in">return</span> <span class="variable">$new_array</span>[<span class="variable">$abs_number</span>-1];</div><div class="line">        &#125;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="keyword">if</span>(<span class="variable">$number</span>&gt;=<span class="variable">$length</span>)&#123;</div><div class="line">            <span class="built_in">return</span> <span class="string">'error'</span>;</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            <span class="built_in">return</span> <span class="variable">$array</span>[<span class="variable">$number</span>];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>11、生成不重复的随机数<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 生成不重复的随机数</div><div class="line"> * @param  int <span class="variable">$start</span>  需要生成的数字开始范围</div><div class="line"> * @param  int <span class="variable">$end</span> 结束范围</div><div class="line"> * @param  int <span class="variable">$length</span> 需要生成的随机数个数</div><div class="line"> * @<span class="built_in">return</span> array       生成的随机数</div><div class="line"> */</div><div class="line"><span class="keyword">function</span> get_rand_number(<span class="variable">$start</span>=1,<span class="variable">$end</span>=10,<span class="variable">$length</span>=4)&#123;</div><div class="line">    <span class="variable">$connt</span>=0;</div><div class="line">    <span class="variable">$temp</span>=array();</div><div class="line">    <span class="keyword">while</span>(<span class="variable">$connt</span>&lt;<span class="variable">$length</span>)&#123;</div><div class="line">        <span class="variable">$temp</span>[]=rand(<span class="variable">$start</span>,<span class="variable">$end</span>);</div><div class="line">        <span class="variable">$data</span>=array_unique(<span class="variable">$temp</span>);</div><div class="line">        <span class="variable">$connt</span>=count(<span class="variable">$data</span>);</div><div class="line">    &#125;</div><div class="line">    sort(<span class="variable">$data</span>);</div><div class="line">    <span class="built_in">return</span> <span class="variable">$data</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>12、处理post上传的文件；并返回路径<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 处理post上传的文件；并返回路径</div><div class="line"> * @param  string <span class="variable">$path</span>    字符串 保存文件路径示例： /Upload/image/</div><div class="line"> * @param  string <span class="variable">$format</span>  文件格式限制</div><div class="line"> * @param  string <span class="variable">$maxSize</span> 允许的上传文件最大值 52428800</div><div class="line"> * @<span class="built_in">return</span> array           返回ajax的json格式数据</div><div class="line"> */</div><div class="line"><span class="keyword">function</span> post_upload(<span class="variable">$path</span>=<span class="string">'file'</span>,<span class="variable">$format</span>=<span class="string">'empty'</span>,<span class="variable">$maxSize</span>=<span class="string">'52428800'</span>)&#123;</div><div class="line">    ini_set(<span class="string">'max_execution_time'</span>, <span class="string">'0'</span>);</div><div class="line">    // 去除两边的/</div><div class="line">    <span class="variable">$path</span>=trim(<span class="variable">$path</span>,<span class="string">'/'</span>);</div><div class="line">    // 添加Upload根目录</div><div class="line">    <span class="variable">$path</span>=strtolower(substr(<span class="variable">$path</span>, 0,6))===<span class="string">'upload'</span> ? ucfirst(<span class="variable">$path</span>) : <span class="string">'Upload/'</span>.<span class="variable">$path</span>;</div><div class="line">    // 上传文件类型控制</div><div class="line">    <span class="variable">$ext_arr</span>= array(</div><div class="line">            <span class="string">'image'</span> =&gt; array(<span class="string">'gif'</span>, <span class="string">'jpg'</span>, <span class="string">'jpeg'</span>, <span class="string">'png'</span>, <span class="string">'bmp'</span>),</div><div class="line">            <span class="string">'photo'</span> =&gt; array(<span class="string">'jpg'</span>, <span class="string">'jpeg'</span>, <span class="string">'png'</span>),</div><div class="line">            <span class="string">'flash'</span> =&gt; array(<span class="string">'swf'</span>, <span class="string">'flv'</span>),</div><div class="line">            <span class="string">'media'</span> =&gt; array(<span class="string">'swf'</span>, <span class="string">'flv'</span>, <span class="string">'mp3'</span>, <span class="string">'wav'</span>, <span class="string">'wma'</span>, <span class="string">'wmv'</span>, <span class="string">'mid'</span>, <span class="string">'avi'</span>, <span class="string">'mpg'</span>, <span class="string">'asf'</span>, <span class="string">'rm'</span>, <span class="string">'rmvb'</span>),</div><div class="line">            <span class="string">'file'</span> =&gt; array(<span class="string">'doc'</span>, <span class="string">'docx'</span>, <span class="string">'xls'</span>, <span class="string">'xlsx'</span>, <span class="string">'ppt'</span>, <span class="string">'htm'</span>, <span class="string">'html'</span>, <span class="string">'txt'</span>, <span class="string">'zip'</span>, <span class="string">'rar'</span>, <span class="string">'gz'</span>, <span class="string">'bz2'</span>,<span class="string">'pdf'</span>)</div><div class="line">        );</div><div class="line">    <span class="keyword">if</span>(!empty(<span class="variable">$_FILES</span>))&#123;</div><div class="line">        // 上传文件配置</div><div class="line">        <span class="variable">$config</span>=array(</div><div class="line">                <span class="string">'maxSize'</span>   =&gt;  <span class="variable">$maxSize</span>,       //   上传文件最大为50M</div><div class="line">                <span class="string">'rootPath'</span>  =&gt;  <span class="string">'./'</span>,           //文件上传保存的根路径</div><div class="line">                <span class="string">'savePath'</span>  =&gt;  <span class="string">'./'</span>.<span class="variable">$path</span>.<span class="string">'/'</span>,         //文件上传的保存路径（相对于根路径）</div><div class="line">                <span class="string">'saveName'</span>  =&gt;  array(<span class="string">'uniqid'</span>,<span class="string">''</span>),     //上传文件的保存规则，支持数组和字符串方式定义</div><div class="line">                <span class="string">'autoSub'</span>   =&gt;  <span class="literal">true</span>,                   //  自动使用子目录保存上传文件 默认为<span class="literal">true</span></div><div class="line">                <span class="string">'exts'</span>    =&gt;    isset(<span class="variable">$ext_arr</span>[<span class="variable">$format</span>])?<span class="variable">$ext_arr</span>[<span class="variable">$format</span>]:<span class="string">''</span>,</div><div class="line">            );</div><div class="line">        // 实例化上传</div><div class="line">        <span class="variable">$upload</span>=new \Think\Upload(<span class="variable">$config</span>);</div><div class="line">        // 调用上传方法</div><div class="line">        <span class="variable">$info</span>=<span class="variable">$upload</span>-&gt;upload();</div><div class="line">        <span class="variable">$data</span>=array();</div><div class="line">        <span class="keyword">if</span>(!<span class="variable">$info</span>)&#123;</div><div class="line">            // 返回错误信息</div><div class="line">            <span class="variable">$error</span>=<span class="variable">$upload</span>-&gt;getError();</div><div class="line">            <span class="variable">$data</span>[<span class="string">'error_info'</span>]=<span class="variable">$error</span>;</div><div class="line">            <span class="built_in">return</span> <span class="variable">$data</span>;</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            // 返回成功信息</div><div class="line">            foreach(<span class="variable">$info</span> as <span class="variable">$file</span>)&#123;</div><div class="line">                <span class="variable">$data</span>[<span class="string">'name'</span>]=trim(<span class="variable">$file</span>[<span class="string">'savepath'</span>].<span class="variable">$file</span>[<span class="string">'savename'</span>],<span class="string">'.'</span>);</div><div class="line">                <span class="built_in">return</span> <span class="variable">$data</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>13、使用curl获取远程数据<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 使用curl获取远程数据</div><div class="line"> * @param  string <span class="variable">$url</span> url连接</div><div class="line"> * @<span class="built_in">return</span> string      获取到的数据</div><div class="line"> */</div><div class="line"><span class="keyword">function</span> curl_get_contents(<span class="variable">$url</span>)&#123;</div><div class="line">    <span class="variable">$ch</span>=curl_init();</div><div class="line">    curl_setopt(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);                //设置访问的url地址</div><div class="line">    // curl_setopt(<span class="variable">$ch</span>,CURLOPT_HEADER,1);               //是否显示头部信息</div><div class="line">    curl_setopt(<span class="variable">$ch</span>, CURLOPT_TIMEOUT, 5);               //设置超时</div><div class="line">    curl_setopt(<span class="variable">$ch</span>, CURLOPT_USERAGENT, <span class="variable">$_SERVER</span>[<span class="string">'HTTP_USER_AGENT'</span>]);   //用户访问代理 User-Agent</div><div class="line">    curl_setopt(<span class="variable">$ch</span>, CURLOPT_REFERER,<span class="variable">$_SERVER</span>[<span class="string">'HTTP_HOST'</span>]);        //设置 referer</div><div class="line">    curl_setopt(<span class="variable">$ch</span>,CURLOPT_FOLLOWLOCATION,1);          //跟踪301</div><div class="line">    curl_setopt(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, 1);        //返回结果</div><div class="line">    <span class="variable">$r</span>=curl_exec(<span class="variable">$ch</span>);</div><div class="line">    curl_close(<span class="variable">$ch</span>);</div><div class="line">    <span class="built_in">return</span> <span class="variable">$r</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>14、计算星座的函数<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">/*</div><div class="line">* 计算星座的函数 string get_zodiac_sign(string month, string day)</div><div class="line">* 输入：月份，日期</div><div class="line">* 输出：星座名称或者错误信息</div><div class="line">*/</div><div class="line"></div><div class="line"><span class="keyword">function</span> get_zodiac_sign(<span class="variable">$month</span>, <span class="variable">$day</span>)</div><div class="line">&#123;</div><div class="line">    // 检查参数有效性</div><div class="line">    <span class="keyword">if</span> (<span class="variable">$month</span> &lt; 1 || <span class="variable">$month</span> &gt; 12 || <span class="variable">$day</span> &lt; 1 || <span class="variable">$day</span> &gt; 31)</div><div class="line">        <span class="built_in">return</span> (<span class="literal">false</span>);</div><div class="line">        // 星座名称以及开始日期</div><div class="line">        <span class="variable">$signs</span> = array(</div><div class="line">        array( <span class="string">"20"</span> =&gt; <span class="string">"水瓶座"</span>),</div><div class="line">        array( <span class="string">"19"</span> =&gt; <span class="string">"双鱼座"</span>),</div><div class="line">        array( <span class="string">"21"</span> =&gt; <span class="string">"白羊座"</span>),</div><div class="line">        array( <span class="string">"20"</span> =&gt; <span class="string">"金牛座"</span>),</div><div class="line">        array( <span class="string">"21"</span> =&gt; <span class="string">"双子座"</span>),</div><div class="line">        array( <span class="string">"22"</span> =&gt; <span class="string">"巨蟹座"</span>),</div><div class="line">        array( <span class="string">"23"</span> =&gt; <span class="string">"狮子座"</span>),</div><div class="line">        array( <span class="string">"23"</span> =&gt; <span class="string">"处女座"</span>),</div><div class="line">        array( <span class="string">"23"</span> =&gt; <span class="string">"天秤座"</span>),</div><div class="line">        array( <span class="string">"24"</span> =&gt; <span class="string">"天蝎座"</span>),</div><div class="line">        array( <span class="string">"22"</span> =&gt; <span class="string">"射手座"</span>),</div><div class="line">        array( <span class="string">"22"</span> =&gt; <span class="string">"摩羯座"</span>)</div><div class="line">    );</div><div class="line">    list(<span class="variable">$sign_start</span>, <span class="variable">$sign_name</span>) = each(<span class="variable">$signs</span>[(int)<span class="variable">$month</span>-1]);</div><div class="line">    <span class="keyword">if</span> (<span class="variable">$day</span> &lt; <span class="variable">$sign_start</span>)</div><div class="line">    list(<span class="variable">$sign_start</span>, <span class="variable">$sign_name</span>) = each(<span class="variable">$signs</span>[(<span class="variable">$month</span> -2 &lt; 0) ? <span class="variable">$month</span> = 11: <span class="variable">$month</span> -= 2]);</div><div class="line">    <span class="built_in">return</span> <span class="variable">$sign_name</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>15、将路径转换加密/解密<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 将路径转换加密</div><div class="line"> * @param  string <span class="variable">$file_path</span> 路径</div><div class="line"> * @<span class="built_in">return</span> string            转换后的路径</div><div class="line"> */</div><div class="line"><span class="keyword">function</span> path_encode(<span class="variable">$file_path</span>)&#123;</div><div class="line">    <span class="built_in">return</span> rawurlencode(base64_encode(<span class="variable">$file_path</span>));</div><div class="line">&#125;</div><div class="line">/**</div><div class="line"> * 将路径解密</div><div class="line"> * @param  string <span class="variable">$file_path</span> 加密后的字符串</div><div class="line"> * @<span class="built_in">return</span> string            解密后的路径</div><div class="line"> */</div><div class="line"><span class="keyword">function</span> path_decode(<span class="variable">$file_path</span>)&#123;</div><div class="line">    <span class="built_in">return</span> base64_decode(rawurldecode(<span class="variable">$file_path</span>));</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>16、根据文件后缀的不同返回不同的结果<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 根据文件后缀的不同返回不同的结果</div><div class="line"> * @param  string <span class="variable">$str</span> 需要判断的文件名或者文件的id</div><div class="line"> * @<span class="built_in">return</span> <span class="built_in">integer</span>     1:图片  2：视频  3：压缩文件  4：文档  5：其他</div><div class="line"> */</div><div class="line"><span class="keyword">function</span> file_category(<span class="variable">$str</span>)&#123;</div><div class="line">    // 取文件后缀名</div><div class="line">    <span class="variable">$str</span>=strtolower(pathinfo(<span class="variable">$str</span>, PATHINFO_EXTENSION));</div><div class="line">    // 图片格式</div><div class="line">    <span class="variable">$images</span>=array(<span class="string">'webp'</span>,<span class="string">'jpg'</span>,<span class="string">'png'</span>,<span class="string">'ico'</span>,<span class="string">'bmp'</span>,<span class="string">'gif'</span>,<span class="string">'tif'</span>,<span class="string">'pcx'</span>,<span class="string">'tga'</span>,<span class="string">'bmp'</span>,<span class="string">'pxc'</span>,<span class="string">'tiff'</span>,<span class="string">'jpeg'</span>,<span class="string">'exif'</span>,<span class="string">'fpx'</span>,<span class="string">'svg'</span>,<span class="string">'psd'</span>,<span class="string">'cdr'</span>,<span class="string">'pcd'</span>,<span class="string">'dxf'</span>,<span class="string">'ufo'</span>,<span class="string">'eps'</span>,<span class="string">'ai'</span>,<span class="string">'hdri'</span>);</div><div class="line">    // 视频格式</div><div class="line">    <span class="variable">$video</span>=array(<span class="string">'mp4'</span>,<span class="string">'avi'</span>,<span class="string">'3gp'</span>,<span class="string">'rmvb'</span>,<span class="string">'gif'</span>,<span class="string">'wmv'</span>,<span class="string">'mkv'</span>,<span class="string">'mpg'</span>,<span class="string">'vob'</span>,<span class="string">'mov'</span>,<span class="string">'flv'</span>,<span class="string">'swf'</span>,<span class="string">'mp3'</span>,<span class="string">'ape'</span>,<span class="string">'wma'</span>,<span class="string">'aac'</span>,<span class="string">'mmf'</span>,<span class="string">'amr'</span>,<span class="string">'m4a'</span>,<span class="string">'m4r'</span>,<span class="string">'ogg'</span>,<span class="string">'wav'</span>,<span class="string">'wavpack'</span>);</div><div class="line">    // 压缩格式</div><div class="line">    <span class="variable">$zip</span>=array(<span class="string">'rar'</span>,<span class="string">'zip'</span>,<span class="string">'tar'</span>,<span class="string">'cab'</span>,<span class="string">'uue'</span>,<span class="string">'jar'</span>,<span class="string">'iso'</span>,<span class="string">'z'</span>,<span class="string">'7-zip'</span>,<span class="string">'ace'</span>,<span class="string">'lzh'</span>,<span class="string">'arj'</span>,<span class="string">'gzip'</span>,<span class="string">'bz2'</span>,<span class="string">'tz'</span>);</div><div class="line">    // 文档格式</div><div class="line">    <span class="variable">$document</span>=array(<span class="string">'exe'</span>,<span class="string">'doc'</span>,<span class="string">'ppt'</span>,<span class="string">'xls'</span>,<span class="string">'wps'</span>,<span class="string">'txt'</span>,<span class="string">'lrc'</span>,<span class="string">'wfs'</span>,<span class="string">'torrent'</span>,<span class="string">'html'</span>,<span class="string">'htm'</span>,<span class="string">'java'</span>,<span class="string">'js'</span>,<span class="string">'css'</span>,<span class="string">'less'</span>,<span class="string">'php'</span>,<span class="string">'pdf'</span>,<span class="string">'pps'</span>,<span class="string">'host'</span>,<span class="string">'box'</span>,<span class="string">'docx'</span>,<span class="string">'word'</span>,<span class="string">'perfect'</span>,<span class="string">'dot'</span>,<span class="string">'dsf'</span>,<span class="string">'efe'</span>,<span class="string">'ini'</span>,<span class="string">'json'</span>,<span class="string">'lnk'</span>,<span class="string">'log'</span>,<span class="string">'msi'</span>,<span class="string">'ost'</span>,<span class="string">'pcs'</span>,<span class="string">'tmp'</span>,<span class="string">'xlsb'</span>);</div><div class="line">    // 匹配不同的结果</div><div class="line">    switch (<span class="variable">$str</span>) &#123;</div><div class="line">        <span class="keyword">case</span> in_array(<span class="variable">$str</span>, <span class="variable">$images</span>):</div><div class="line">            <span class="built_in">return</span> 1;</div><div class="line">            <span class="built_in">break</span>;</div><div class="line">        <span class="keyword">case</span> in_array(<span class="variable">$str</span>, <span class="variable">$video</span>):</div><div class="line">            <span class="built_in">return</span> 2;</div><div class="line">            <span class="built_in">break</span>;</div><div class="line">        <span class="keyword">case</span> in_array(<span class="variable">$str</span>, <span class="variable">$zip</span>):</div><div class="line">            <span class="built_in">return</span> 3;</div><div class="line">            <span class="built_in">break</span>;</div><div class="line">        <span class="keyword">case</span> in_array(<span class="variable">$str</span>, <span class="variable">$document</span>):</div><div class="line">            <span class="built_in">return</span> 4;</div><div class="line">            <span class="built_in">break</span>;</div><div class="line">        default:</div><div class="line">            <span class="built_in">return</span> 5;</div><div class="line">            <span class="built_in">break</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>17、传入时间戳,计算距离现在的时间<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 传入时间戳,计算距离现在的时间</div><div class="line"> * @param  number <span class="variable">$time</span> 时间戳</div><div class="line"> * @<span class="built_in">return</span> string       返回多少以前</div><div class="line"> */</div><div class="line"><span class="keyword">function</span> word_time(<span class="variable">$time</span>) &#123;</div><div class="line">    <span class="variable">$time</span> = (int) substr(<span class="variable">$time</span>, 0, 10);</div><div class="line">    <span class="variable">$int</span> = time() - <span class="variable">$time</span>;</div><div class="line">    <span class="variable">$str</span> = <span class="string">''</span>;</div><div class="line">    <span class="keyword">if</span> (<span class="variable">$int</span> &lt;= 2)&#123;</div><div class="line">        <span class="variable">$str</span> = sprintf(<span class="string">'刚刚'</span>, <span class="variable">$int</span>);</div><div class="line">    &#125;elseif (<span class="variable">$int</span> &lt; 60)&#123;</div><div class="line">        <span class="variable">$str</span> = sprintf(<span class="string">'%d秒前'</span>, <span class="variable">$int</span>);</div><div class="line">    &#125;elseif (<span class="variable">$int</span> &lt; 3600)&#123;</div><div class="line">        <span class="variable">$str</span> = sprintf(<span class="string">'%d分钟前'</span>, floor(<span class="variable">$int</span> / 60));</div><div class="line">    &#125;elseif (<span class="variable">$int</span> &lt; 86400)&#123;</div><div class="line">        <span class="variable">$str</span> = sprintf(<span class="string">'%d小时前'</span>, floor(<span class="variable">$int</span> / 3600));</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="variable">$str</span> = date(<span class="string">'Y-m-d H:i:s'</span>, <span class="variable">$time</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">return</span> <span class="variable">$str</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>18、生成缩略图<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 生成缩略图</div><div class="line"> * @param  string  <span class="variable">$image_path</span> 原图path</div><div class="line"> * @param  <span class="built_in">integer</span> <span class="variable">$width</span>      缩略图的宽</div><div class="line"> * @param  <span class="built_in">integer</span> <span class="variable">$height</span>     缩略图的高</div><div class="line"> * @<span class="built_in">return</span> string             缩略图path</div><div class="line"> */</div><div class="line"><span class="keyword">function</span> crop_image(<span class="variable">$image_path</span>,<span class="variable">$width</span>=170,<span class="variable">$height</span>=170)&#123;</div><div class="line">    <span class="variable">$image_path</span>=trim(<span class="variable">$image_path</span>,<span class="string">'.'</span>);</div><div class="line">    <span class="variable">$min_path</span>=<span class="string">'.'</span>.str_replace(<span class="string">'.'</span>, <span class="string">'_'</span>.<span class="variable">$width</span>.<span class="string">'_'</span>.<span class="variable">$height</span>.<span class="string">'.'</span>, <span class="variable">$image_path</span>);</div><div class="line">    <span class="variable">$image</span> = new \Think\Image();</div><div class="line">    <span class="variable">$image</span>-&gt;open(<span class="variable">$image_path</span>);</div><div class="line">    // 生成一个居中裁剪为<span class="variable">$width</span>*<span class="variable">$height</span>的缩略图并保存</div><div class="line">    <span class="variable">$image</span>-&gt;thumb(<span class="variable">$width</span>, <span class="variable">$height</span>,\Think\Image::IMAGE_THUMB_CENTER)-&gt;save(<span class="variable">$min_path</span>);</div><div class="line">    oss_upload(<span class="variable">$min_path</span>);</div><div class="line">    <span class="built_in">return</span> <span class="variable">$min_path</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>19、检测是否是手机访问<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span> <span class="function"><span class="title">is_mobile</span></span>()&#123;</div><div class="line">    <span class="variable">$useragent</span>=isset(<span class="variable">$_SERVER</span>[<span class="string">'HTTP_USER_AGENT'</span>]) ? <span class="variable">$_SERVER</span>[<span class="string">'HTTP_USER_AGENT'</span>] : <span class="string">''</span>;</div><div class="line">    <span class="variable">$useragent_commentsblock</span>=preg_match(<span class="string">'|\(.*?\)|'</span>,<span class="variable">$useragent</span>,<span class="variable">$matches</span>)&gt;0?<span class="variable">$matches</span>[0]:<span class="string">''</span>;</div><div class="line">    <span class="keyword">function</span> _is_mobile(<span class="variable">$substrs</span>,<span class="variable">$text</span>)&#123;</div><div class="line">        foreach(<span class="variable">$substrs</span> as <span class="variable">$substr</span>)</div><div class="line">            <span class="keyword">if</span>(<span class="literal">false</span>!==strpos(<span class="variable">$text</span>,<span class="variable">$substr</span>))&#123;</div><div class="line">                <span class="built_in">return</span> <span class="literal">true</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="built_in">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="variable">$mobile_os_list</span>=array(<span class="string">'Google Wireless Transcoder'</span>,<span class="string">'Windows CE'</span>,<span class="string">'WindowsCE'</span>,<span class="string">'Symbian'</span>,<span class="string">'Android'</span>,<span class="string">'armv6l'</span>,<span class="string">'armv5'</span>,<span class="string">'Mobile'</span>,<span class="string">'CentOS'</span>,<span class="string">'mowser'</span>,<span class="string">'AvantGo'</span>,<span class="string">'Opera Mobi'</span>,<span class="string">'J2ME/MIDP'</span>,<span class="string">'Smartphone'</span>,<span class="string">'Go.Web'</span>,<span class="string">'Palm'</span>,<span class="string">'iPAQ'</span>);</div><div class="line">    <span class="variable">$mobile_token_list</span>=array(<span class="string">'Profile/MIDP'</span>,<span class="string">'Configuration/CLDC-'</span>,<span class="string">'160×160'</span>,<span class="string">'176×220'</span>,<span class="string">'240×240'</span>,<span class="string">'240×320'</span>,<span class="string">'320×240'</span>,<span class="string">'UP.Browser'</span>,<span class="string">'UP.Link'</span>,<span class="string">'SymbianOS'</span>,<span class="string">'PalmOS'</span>,<span class="string">'PocketPC'</span>,<span class="string">'SonyEricsson'</span>,<span class="string">'Nokia'</span>,<span class="string">'BlackBerry'</span>,<span class="string">'Vodafone'</span>,<span class="string">'BenQ'</span>,<span class="string">'Novarra-Vision'</span>,<span class="string">'Iris'</span>,<span class="string">'NetFront'</span>,<span class="string">'HTC_'</span>,<span class="string">'Xda_'</span>,<span class="string">'SAMSUNG-SGH'</span>,<span class="string">'Wapaka'</span>,<span class="string">'DoCoMo'</span>,<span class="string">'iPhone'</span>,<span class="string">'iPod'</span>);</div><div class="line"></div><div class="line">    <span class="variable">$found_mobile</span>=_is_mobile(<span class="variable">$mobile_os_list</span>,<span class="variable">$useragent_commentsblock</span>) ||</div><div class="line">              _is_mobile(<span class="variable">$mobile_token_list</span>,<span class="variable">$useragent</span>);</div><div class="line">    <span class="keyword">if</span> (<span class="variable">$found_mobile</span>)&#123;</div><div class="line">        <span class="built_in">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="built_in">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>20、给已经存在的图片添加水印<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 给已经存在的图片添加水印</div><div class="line"> * @param string <span class="variable">$file_path</span></div><div class="line"> * @<span class="built_in">return</span> bool</div><div class="line"> */</div><div class="line"><span class="keyword">function</span> addMark(<span class="variable">$file_path</span>) &#123;</div><div class="line">    <span class="keyword">if</span> (file_exists(<span class="variable">$file_path</span>) &amp;&amp; file_exists(MARK)) &#123;</div><div class="line">        //求出上传图片的名称后缀</div><div class="line">        <span class="variable">$ext_name</span> = strtolower(substr(<span class="variable">$file_path</span>, strrpos(<span class="variable">$file_path</span>, <span class="string">'.'</span>), strlen(<span class="variable">$file_path</span>)));</div><div class="line">        //<span class="variable">$new_name</span>=<span class="string">'jzy_'</span> . time() . rand(1000,9999) . <span class="variable">$ext_name</span> ;</div><div class="line">        <span class="variable">$store_path</span> = ROOT_PATH . UPDIR;</div><div class="line">        //求上传图片高宽</div><div class="line">        <span class="variable">$imginfo</span> = getimagesize(<span class="variable">$file_path</span>);</div><div class="line">        <span class="variable">$width</span> = <span class="variable">$imginfo</span>[0];</div><div class="line">        <span class="variable">$height</span> = <span class="variable">$imginfo</span>[1];</div><div class="line">        //添加图片水印</div><div class="line">        switch(<span class="variable">$ext_name</span>) &#123;</div><div class="line">            <span class="keyword">case</span> <span class="string">'.gif'</span>:</div><div class="line">                <span class="variable">$dst_im</span> = imagecreatefromgif(<span class="variable">$file_path</span>);</div><div class="line">                <span class="built_in">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="string">'.jpg'</span>:</div><div class="line">                <span class="variable">$dst_im</span> = imagecreatefromjpeg(<span class="variable">$file_path</span>);</div><div class="line">                <span class="built_in">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="string">'.png'</span>:</div><div class="line">                <span class="variable">$dst_im</span> = imagecreatefrompng(<span class="variable">$file_path</span>);</div><div class="line">                <span class="built_in">break</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="variable">$src_im</span> = imagecreatefrompng(MARK);</div><div class="line">        //求水印图片高宽</div><div class="line">        <span class="variable">$src_imginfo</span> = getimagesize(MARK);</div><div class="line">        <span class="variable">$src_width</span> = <span class="variable">$src_imginfo</span>[0];</div><div class="line">        <span class="variable">$src_height</span> = <span class="variable">$src_imginfo</span>[1];</div><div class="line">        //求出水印图片的实际生成位置</div><div class="line">        <span class="variable">$src_x</span> = <span class="variable">$width</span> - <span class="variable">$src_width</span> - 10;</div><div class="line">        <span class="variable">$src_y</span> = <span class="variable">$height</span> - <span class="variable">$src_height</span> - 10;</div><div class="line">        //新建一个真彩色图像</div><div class="line">        <span class="variable">$nimage</span> = imagecreatetruecolor(<span class="variable">$width</span>, <span class="variable">$height</span>);</div><div class="line">        //拷贝上传图片到真彩图像</div><div class="line">        imagecopy(<span class="variable">$nimage</span>, <span class="variable">$dst_im</span>, 0, 0, 0, 0, <span class="variable">$width</span>, <span class="variable">$height</span>);</div><div class="line">        //按坐标位置拷贝水印图片到真彩图像上</div><div class="line">        imagecopy(<span class="variable">$nimage</span>, <span class="variable">$src_im</span>, <span class="variable">$src_x</span>, <span class="variable">$src_y</span>, 0, 0, <span class="variable">$src_width</span>, <span class="variable">$src_height</span>);</div><div class="line">        //分情况输出生成后的水印图片</div><div class="line">        switch(<span class="variable">$ext_name</span>) &#123;</div><div class="line">            <span class="keyword">case</span> <span class="string">'.gif'</span>:</div><div class="line">                imagegif(<span class="variable">$nimage</span>, <span class="variable">$file_path</span>);</div><div class="line">                <span class="built_in">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="string">'.jpg'</span>:</div><div class="line">                imagejpeg(<span class="variable">$nimage</span>, <span class="variable">$file_path</span>);</div><div class="line">                <span class="built_in">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="string">'.png'</span>:</div><div class="line">                imagepng(<span class="variable">$nimage</span>, <span class="variable">$file_path</span>);</div><div class="line">                <span class="built_in">break</span>;</div><div class="line">        &#125;</div><div class="line">        //释放资源</div><div class="line">        imagedestroy(<span class="variable">$dst_im</span>);</div><div class="line">        imagedestroy(<span class="variable">$src_im</span>);</div><div class="line">        <span class="built_in">unset</span>(<span class="variable">$imginfo</span>);</div><div class="line">        <span class="built_in">unset</span>(<span class="variable">$src_imginfo</span>);</div><div class="line">        //移动生成后的图片</div><div class="line">        @move_uploaded_file(<span class="variable">$file_path</span>, ROOT_PATH.UPDIR . <span class="variable">$file_path</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>21、图片等比例缩放<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 图片等比例缩放</div><div class="line"> * @param resource <span class="variable">$im</span>    新建图片资源(imagecreatefromjpeg/imagecreatefrompng/imagecreatefromgif)</div><div class="line"> * @param int <span class="variable">$maxwidth</span>   生成图像宽</div><div class="line"> * @param int <span class="variable">$maxheight</span>  生成图像高</div><div class="line"> * @param string <span class="variable">$name</span>    生成图像名称</div><div class="line"> * @param string <span class="variable">$filetype</span>文件类型(.jpg/.gif/.png)</div><div class="line"> */</div><div class="line"><span class="keyword">function</span> resizeImage(<span class="variable">$im</span>, <span class="variable">$maxwidth</span>, <span class="variable">$maxheight</span>, <span class="variable">$name</span>, <span class="variable">$filetype</span>) &#123;</div><div class="line">    <span class="variable">$pic_width</span> = imagesx(<span class="variable">$im</span>);</div><div class="line">    <span class="variable">$pic_height</span> = imagesy(<span class="variable">$im</span>);</div><div class="line">    <span class="keyword">if</span>((<span class="variable">$maxwidth</span> &amp;&amp; <span class="variable">$pic_width</span> &gt; <span class="variable">$maxwidth</span>) || (<span class="variable">$maxheight</span> &amp;&amp; <span class="variable">$pic_height</span> &gt; <span class="variable">$maxheight</span>)) &#123;</div><div class="line">        <span class="keyword">if</span>(<span class="variable">$maxwidth</span> &amp;&amp; <span class="variable">$pic_width</span>&gt;<span class="variable">$maxwidth</span>) &#123;</div><div class="line">            <span class="variable">$widthratio</span> = <span class="variable">$maxwidth</span>/<span class="variable">$pic_width</span>;</div><div class="line">            <span class="variable">$resizewidth_tag</span> = <span class="literal">true</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(<span class="variable">$maxheight</span> &amp;&amp; <span class="variable">$pic_height</span>&gt;<span class="variable">$maxheight</span>) &#123;</div><div class="line">            <span class="variable">$heightratio</span> = <span class="variable">$maxheight</span>/<span class="variable">$pic_height</span>;</div><div class="line">            <span class="variable">$resizeheight_tag</span> = <span class="literal">true</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(<span class="variable">$resizewidth_tag</span> &amp;&amp; <span class="variable">$resizeheight_tag</span>) &#123;</div><div class="line">            <span class="keyword">if</span>(<span class="variable">$widthratio0</span>)) &#123;</div><div class="line">        <span class="variable">$file_data</span> = fread(<span class="variable">$fp</span>, <span class="variable">$buffer</span>);</div><div class="line">        <span class="variable">$file_count</span> += <span class="variable">$buffer</span>;</div><div class="line">        <span class="built_in">echo</span> <span class="variable">$file_data</span>;</div><div class="line">    &#125;</div><div class="line">    fclose(<span class="variable">$fp</span>); //关闭文件</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/11/20/PHP自定义函数/" class="archive-article-date">
  	<time datetime="2016-11-19T17:50:47.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-11-20</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP/">PHP</a></li></ul>
	</div>

      

      <div class="clearfix"></div>
    </div>
  </div>
</article>

  
<nav id="article-nav">
  
    <a href="/2016/11/20/checkbox全选与反选/" id="article-nav-newer" class="article-nav-link-wrap">
      <i class="icon-circle-left"></i>
      <div class="article-nav-title">
        
          checkbox全选与反选
        
      </div>
    </a>
  
  
    <a href="/2016/11/19/PHP年龄计算/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">PHP年龄计算</div>
      <i class="icon-circle-right"></i>
    </a>
  
</nav>




<div class="share_jia">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">Share to: &nbsp; </span>
		<a class="jiathis_button_facebook"></a> 
	    <a class="jiathis_button_twitter"></a>
	    <a class="jiathis_button_plus"></a> 
	    <a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="//v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>









      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 Vhen
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: true
	}
</script>

<script src="/./main.js"></script>


    
<div class="tools-col">
  <ul class="btn-wrap">
    
      <li class="chose" data-hook="tools-section-all"><span class="text">全部</span><i class="icon-book"></i></li>
    
    
      <li data-hook="tools-section-tag"><span class="text">标签</span><i class="icon-price-tags"></i></li>
    
    
      <li data-hook="tools-section-friends"><span class="text">友链</span><i class="icon-link"></i></li>
    
    
      <li data-hook="tools-section-me"><span class="text">我</span><i class="icon-smile"></i></li>
    
  </ul>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all chose">
    	</section>
    

    
    	<section class="tools-section tools-section-tag">
    			<div class="widget tagcloud" id="js-tagcloud">
    				<a href="/tags/PHP/" style="font-size: 20px;">PHP</a> <a href="/tags/ThinkPHP/" style="font-size: 10px;">ThinkPHP</a> <a href="/tags/css/" style="font-size: 10px;">css</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/jquery/" style="font-size: 10px;">jquery</a> <a href="/tags/正则表达式/" style="font-size: 10px;">正则表达式</a> <a href="/tags/移动端/" style="font-size: 10px;">移动端</a>
    			</div>
    	</section>
    

    
    	<section class="tools-section tools-section-friends">
  		
  			<div class="friends-wrap" id="js-friends">
  			
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://document.thinkphp.cn/manual_3_2.html">ThinkPHP3.2.3手册</a>
  	        
  	          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.bootcss.com/">Bootstrap</a>
  	        
  	        </div>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">如果心里因人不爽，最好的办法就是说出来告诉对方。一来自己不会再纠结，二来可以让对方纠结，三来如果对方并不因此纠结，就证明对方压根儿不在意你，那你又何必要为不在意你的人影响自己的心情。有话就说的人不是直肠子，而是不会让自己辛苦的透明人...</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>